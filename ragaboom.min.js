var RB={};
RB.Scene=function(a){if(!a)throw"RB.Scene(canvasObject): You must specify a canvas object";var k=a.width,j=a.height;this.ctx=a.getContext("2d");var b=[],p=!1,m=null,q=0,t=0,h=[],d=[],f=!1,i=0,l=0;this.add=function(c){if(!c)throw"RB.Scene.add(o): the object you are trying to add to the scene doesn't exist.";b.push(c);c.isCollidable()&&h.push(c);c.isDraggable()&&d.push(c);return c};this.addLots=function(c){for(var g=0;g<c.length;g++)this.add(c[g])};this.remove=function(c){for(var c=c.getUniqueId(),g=
b.length,a=d.length,f=h.length,e=0;e<g;e++)if(c==b[e].getUniqueId()){b.splice(e,1);break}for(e=0;e<f;e++)if(c==h[e].getUniqueId()){h.splice(e,1);break}for(e=0;e<a;e++)if(c==d[e].getUniqueId()){d.splice(e,1);break}};this.removeLots=function(c){for(var g=0;g<c.length;g++)this.remove(c[g])};this.removeAll=function(){var c=d.length,g=h.length;b.splice(0,b.length);h.splice(0,g);d.splice(0,c)};var n=this;a.onmousemove=function(c){n.mouseMove(c);n.onmousemove(c)};a.onmousedown=function(c){n.canvasOnmousedown(c)};
a.onmouseup=function(){p=!1};document.onkeydown=function(c){n.onkeydown(c)};document.onkeyup=function(c){n.onkeyup(c)};this.onmousemove=function(){};this.mouseMove=function(c,g){p&&m&&(m.setX(RB.xPos(c)-q),m.setY(RB.yPos(c)-t),f||this.update());g&&g()};this.canvasOnmousedown=function(c,g){for(var a=d.length,b=0;b<a;b++){var e=d[b];if(e.checkRange(RB.xPos(c),RB.yPos(c))){m=e;currentObjectIndex=b;q=RB.xPos(c)-m.getX();t=RB.yPos(c)-m.getY();p=!0;break}}g&&g()};this.onkeydown=function(){};this.onkeyup=
function(){};this.getObjectSize=function(){return b.length};this.getObj=function(c){return b[c]};this.rect=function(c,g,a,b){b=RB.createCanvas(c,g,b).getContext("2d");b.fillStyle=RB.getFS(a,b,g);b.fillRect(0,0,c,g)};this.image=function(c,g){var a=new Image,b=this;a.onload=function(){RB.createCanvas(a.width,a.height,g).getContext("2d").drawImage(this,0,0);l++;l==i&&b.doAfterLoad()};a.src=c;i++};this.imagePattern=function(c,a,b,d,e){var f=new Image,h=this;f.onload=function(){var c=RB.createCanvas(a,
b,e).getContext("2d"),j=c.createPattern(f,d);c.fillStyle=j;c.fillRect(0,0,a,b);l++;l==i&&h.doAfterLoad()};f.src=c;i++};this.roundRect=function(c,a,b,f,e){if(!c||!a||!b||!f||!e)throw"All parameters must be set: roundRect(w, h, arc, fillStyle, id);";e=RB.createCanvas(c,a,e).getContext("2d");e.beginPath();e.moveTo(0+b,0);e.lineTo(c+0-b,0);e.quadraticCurveTo(c+0,0,c+0,0+b);e.lineTo(c+0,a+0-b);e.quadraticCurveTo(c+0,0+a,c+0-b,0+a);e.lineTo(0+b,0+a);e.quadraticCurveTo(0,0+a,0,0+a-b);e.lineTo(0,0+b);e.quadraticCurveTo(0,
0,0+b,0);e.closePath();e.fillStyle=RB.getFS(f,e,a);e.fill()};this.text=function(c,a,b,f,e){var d=RB.getTextBuffer();d.innerHTML=c;d.style.fontFamily=a;d.style.fontSize=b+"px";var h=RB.el(e);h?(h.getContext("2d").clearRect(0,0,d.offsetWidth,d.offsetHeight+15),h.width=d.offsetWidth,h.height=d.offsetHeight+15):h=RB.createCanvas(d.offsetWidth,d.offsetHeight+15,e);e=h.getContext("2d");e.fillStyle=RB.getFS(f,e,d.offsetHeight+25);e.font="normal "+b+"px "+a;e.fillText(c,0,d.offsetHeight+5)};this.start=function(){f=
!0;this.animate()};this.stop=function(){f=!1};this.toggleStart=function(){f?this.stop():this.start()};this.onLoop=function(){};this.runOnce=function(){for(var c=b.length,a=0;a<c;a++){var d=b[a];if(d.isVisible()&&(d.run(),d.isCollidable()&&!d.isObstacle()))for(var f=h.length,e=0;e<f;e++){var i=h[e];if(d.getUniqueId()!=i.getUniqueId())if(i=d.checkCollision(i),i.top||i.bottom||i.left||i.right){d.setIsColliding(!0);d.setCollidingCoords(i);break}else d.setIsColliding(!1),d.setCollidingCoords(null)}}};
this.animate=function(){this.runOnce();this.onLoop();if(f){var a=this;setTimeout(function(){a.animate()},24)}};this.update=function(){for(var a=b.length,d=0;d<a;d++)b[d].run()};this.getW=function(){return k};this.getH=function(){return j};this.doAfterLoad=function(){}};
RB.Obj=function(a,k,j,b){if(!k)throw"RB.Obj(c, sceneContext, _x, _y): You must specify a scene context";var p=Math.random(),m="",q=k,t=null,h=null,d=0,f=0,i=0,l=0;j&&(d=j);b&&(f=b);var n=!0,c=!1,g=!1,A=!1,B=null,e=null,w=!1,C=0,D=0,r=1,s=1,x=0,u=null,v=1;this.setSpriteInterval=function(o){v=o};this.getSpriteInterval=function(){return v};var y=0,z=0;this.setCanvas=function(o){h=typeof o=="object"?o:RB.el(o);i=h.width;l=h.height;C=d+i;D=f+l};this.setCoords=function(o,a){d=o;f=a};this.setDimension=function(o,
a){i=o;l=a};this.setCanvas(a);this.getCanvas=function(){return h};this.getUniqueId=function(){return p};this.setSCtx=function(a){q=a};this.getSCtx=function(){return q};this.setCtx=function(a){t=a};this.getCtx=function(){return t};this.setX=function(a){d=a};this.getX=function(){return d};this.setY=function(a){f=a};this.getY=function(){return f};this.setXY=function(a,c){d=a;f=c};this.setW=function(a){i=a};this.getW=function(){return i};this.setH=function(a){l=a};this.getH=function(){return l};this.setCounter=
function(a){x=a};this.getCounter=function(){return x};this.setSpeedX=function(a){r=a};this.getSpeedX=function(){return r};this.setSpeedY=function(a){s=a};this.getSpeedY=function(){return s};this.setSpeed=function(a){s=r=a};this.setCollidable=function(a){c=a};this.isCollidable=function(){return c};this.setObstacle=function(a){g=a};this.isObstacle=function(){return g};this.setDraggable=function(a){w=a};this.isDraggable=function(){return w};this.setName=function(a){m=a};this.getName=function(){return m};
this.setIsColliding=function(a){A=a};this.isColliding=function(){return A};this.setCollidingCoords=function(a){B=a};this.getCollidingCoords=function(){return B};this.getX2=function(){return C};this.getY2=function(){return D};this.setVisible=function(a){n=a};this.isVisible=function(){return n};this.ds=function(){return m+": x="+d+", y="+f+", w="+i+", h="+l};this.fn=function(){this.draw()};this.run=function(){this.fn()};this.clone=function(){var b=new RB.Obj(a,q);b.setX(d);b.setY(f);b.setW(i);b.setH(l);
b.setCollidable(c);b.setObstacle(g);b.setCounter(x);b.fn=this.fn;b.setSpeedX(r);b.setSpeedY(s);b.setSprites(u,this.getSpriteInterval());b.setDraggable(w);b.setVisible(n);return b};this.draw=function(a,b){a&&b?q.drawImage(h,d,f,a,b):q.drawImage(h,d,f)};this.up=function(){f-=s;e="up"};this.down=function(){f+=s;e="down"};this.left=function(){d-=r;e="left"};this.right=function(){d+=r;e="right"};this.setSprites=function(a,b){u=a;v=b};this.animateSprite=function(){y==v?(h=u[++z]?u[z]:u[z=0],y=0):y++};this.checkCollision=
function(a){var b=a.getX(),c=a.getY(),g=a.getX()+a.getW(),a=a.getY()+a.getH(),h={top:!1,bottom:!1,left:!1,right:!1};if(e=="up"){var j=f<a&&f+l>a,k=d<g&&d+i>b;j&&k&&(h.top=!0)}if(e=="down")j=f+l>c&&f+l<a,k=d<g&&d+i>b,j&&k&&(h.bottom=!0);if(e=="left")j=f<a&&f+l>c,k=d<g&&d+i>g,j&&k&&(h.left=!0);if(e=="right")j=f<a&&f+l>c,k=d+i>b&&d+i<g,j&&k&&(h.right=!0);return h};this.checkRange=function(a,b){var c=b>=f&&b<=f+l;return a>=d&&a<=d+i&&c};this.onCollide=function(){};this.onNonCollide=function(){};this.boom=
function(){this.onCollide()}};RB.createTextBuffer=function(){var a=document.createElement("div");a.id="txtBuffer";a.style.position="absolute";a.style.width="auto";a.style.height="auto";a.style.padding="0px";a.style.visibility="hidden";document.body.appendChild(a)};RB.getTextBuffer=function(){RB.el("txtBuffer")||RB.createTextBuffer();return RB.el("txtBuffer")};
RB.createCanvas=function(a,k,j){var b=document.createElement("canvas");b.width=a;b.height=k;b.id=j;b.style.display="none";document.body.appendChild(b);return b};RB.el=function(a){return document.getElementById(a)};RB.linearGradient=function(a,k){var j=k.createLinearGradient(0,5,0,a.h);csLen=a.colors.length;for(var b=0;b<csLen;b++){var p=a.colors[b];j.addColorStop(p.stopPoint,p.name)}return j};RB.getFS=function(a,k,j){if(typeof a=="object")return a.h=j,RB.linearGradient(a,k);return a};
RB.rtImage=function(a,k,j){var b=new Image;b.onload=function(){RB.createCanvas(b.width,b.height,k).getContext("2d").drawImage(this,0,0);j&&j()};b.src=a};RB.canvasSupport=function(a){if(a)try{return a.getContext("2d"),!0}catch(k){return!1}else return!1};RB.xPos=function(a){return a.pageX-a.target.offsetLeft};RB.yPos=function(a){return a.pageY-a.target.offsetTop};

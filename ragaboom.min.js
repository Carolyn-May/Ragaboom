var RB={};
RB.Scene=function(b,g){if(!b)throw"RB.Scene(canvasObject): You must specify a canvas object";g||(g=24);var i=g,l=document,m=b.width,y=b.height;this.ctx=b.getContext("2d");var h=[],w=!1,q=null,j=0,k=0,n=[],p=[],r=!1,t=0,u=0;this.setLoopTime=function(a){i=a};this.getLoopTime=function(){return i};this.add=function(a){if(!a)throw"RB.Scene.add(o): the object you are trying to add to the scene doesn't exist.";h.push(a);a.isCollidable()&&n.push(a);a.isDraggable()&&p.push(a);return a};this.addLots=function(a){for(var e=
0;e<a.length;e++)this.add(a[e])};this.remove=function(a){for(var a=a.getUniqueId(),e=h.length,c=p.length,b=n.length,d=0;d<e;d++)if(a==h[d].getUniqueId()){h.splice(d,1);break}for(d=0;d<b;d++)if(a==n[d].getUniqueId()){n.splice(d,1);break}for(d=0;d<c;d++)if(a==p[d].getUniqueId()){p.splice(d,1);break}};this.removeLots=function(a){for(var e=0;e<a.length;e++)this.remove(a[e])};this.removeAll=function(){var a=p.length,e=n.length;h.splice(0,h.length);n.splice(0,e);p.splice(0,a)};this.zIndex=function(a,e){var c=
h.length,b=getIdByObject(a),d=b+e;d<0&&(d=0);d>=c&&(d=c-1);c=h[b];h[b]=h[d];h[d]=c};getObjectById=function(a){for(var e=h.length,c=0;c<e;c++)if(h[c].getUniqueId()==a)return o;return null};getIdByObject=function(a){for(var e=h.length,c=0;c<e;c++)if(h[c].getUniqueId()==a.getUniqueId())return c;return null};this.onmousemove=function(){};this.onmousedown=function(){};this.onmouseup=function(){};this.onkeydown=function(){};this.onkeyup=function(){};var s=this;b.onmousemove=function(a){mouseMove(a);s.onmousemove(a)};
b.onmousedown=function(a){mousedown(a);s.onmousedown(a)};b.onmouseup=function(a){w=!1;s.onmouseup(a)};l.onkeydown=function(a){s.onkeydown(a)};l.onkeyup=function(a){s.onkeyup(a)};mouseMove=function(a){w&&q&&(q.setX(RB.xPos(a)-j),q.setY(RB.yPos(a)-k),r||s.update())};mousedown=function(a){for(var e=p.length-1;e>=0;e--){var c=p[e];if(c.checkRange(RB.xPos(a),RB.yPos(a))){q=c;currentObjectIndex=e;j=RB.xPos(a)-q.getX();k=RB.yPos(a)-q.getY();w=!0;break}}};this.getObjectSize=function(){return h.length};this.getObj=
function(a){return h[a]};this.rect=function(a,e,c,b){var b=RB.createCanvas(a,e,b),d=b.getContext("2d");d.fillStyle=RB.getFS(c,d,e);d.fillRect(0,0,a,e);return b};this.image=function(a,e){var c=new Image,b=this,d=null;c.onload=function(){d=RB.createCanvas(c.width,c.height,e);d.getContext("2d").drawImage(this,0,0);u++;u==t&&b.doAfterLoad()};c.src=a;t++};this.imagePattern=function(a,e,c,b,d){var f=new Image,h=this;f.onload=function(){var a=RB.createCanvas(e,c,d).getContext("2d"),g=a.createPattern(f,b);
a.fillStyle=g;a.fillRect(0,0,e,c);u++;u==t&&h.doAfterLoad()};f.src=a;t++};this.roundRect=function(a,e,c,b,d){if(!a||!e||!c||!b||!d)throw"All parameters must be set: roundRect(w, h, arc, fillStyle, id);";var d=RB.createCanvas(a,e,d),f=d.getContext("2d");f.beginPath();f.moveTo(0+c,0);f.lineTo(a+0-c,0);f.quadraticCurveTo(a+0,0,a+0,0+c);f.lineTo(a+0,e+0-c);f.quadraticCurveTo(a+0,0+e,a+0-c,0+e);f.lineTo(0+c,0+e);f.quadraticCurveTo(0,0+e,0,0+e-c);f.lineTo(0,0+c);f.quadraticCurveTo(0,0,0+c,0);f.closePath();
f.fillStyle=RB.getFS(b,f,e);f.fill();return d};this.text=function(a,e,b,h,d){var f=RB.getTextBuffer();f.innerHTML=a;f.style.fontFamily=e;f.style.fontSize=b+"px";var g=RB.el(d);g?(d=g.getContext("2d"),g.width=f.offsetWidth,g.height=f.offsetHeight+15,d.clearRect(0,0,f.offsetWidth,f.offsetHeight+15)):(g=RB.createCanvas(f.offsetWidth,f.offsetHeight+15,d),d=g.getContext("2d"));d.fillStyle=RB.getFS(h,d,f.offsetHeight+25);d.font="normal "+b+"px "+e;d.fillText(a,0,f.offsetHeight+5);return g};this.start=function(){r=
!0;this.animate()};this.stop=function(){r=!1};this.toggleStart=function(){r?this.stop():this.start()};this.onLoop=function(){};this.runOnce=function(){for(var a=h.length,b=0;b<a;b++){var c=h[b];if(c.isVisible()&&(c.run(),c.isCollidable()&&!c.isObstacle()))for(var g=n.length,d=0;d<g;d++){var f=n[d];if(c.getUniqueId()!=f.getUniqueId())if(f=c.checkCollision(f,!0),f.top||f.bottom||f.left||f.right){c.setIsColliding(!0);c.setCollidingCoords(f);break}else c.setIsColliding(!1),c.setCollidingCoords(null)}}};
this.animate=function(){this.runOnce();this.onLoop();if(r){var a=this;setTimeout(function(){a.animate()},i)}};this.update=function(){for(var a=h.length,b=0;b<a;b++)h[b].run()};this.getW=function(){return m};this.getH=function(){return y};this.doAfterLoad=function(){}};
RB.Obj=function(b,g,i,l){if(!g)throw"RB.Obj(c, sceneContext, _x, _y): You must specify a scene context";var m=Math.random(),y="",h=g,w=null,q=null,j=0,k=0,n=0,p=0;i&&(j=i);l&&(k=l);var r=!0,t=!1,u=!1,s=!1,a=null,e=null,c=!1,v=1,d=1,f=0,x=null,z=1;this.setSpriteInterval=function(a){z=a};this.getSpriteInterval=function(){return z};var A=0,B=0;this.setCanvas=function(a){q=typeof a=="object"?a:RB.el(a);n=q.width;p=q.height};this.setCoords=function(a,b){j=a;k=b};this.setDimension=function(a,b){n=a;p=b};
this.setCanvas(b);this.getCanvas=function(){return q};this.getUniqueId=function(){return m};this.setSCtx=function(a){h=a};this.getSCtx=function(){return h};this.setCtx=function(a){w=a};this.getCtx=function(){return w};this.setX=function(a){j=a};this.getX=function(){return j};this.setY=function(a){k=a};this.getY=function(){return k};this.setXY=function(a,b){j=a;k=b};this.setW=function(a){n=a};this.getW=function(){return n};this.setH=function(a){p=a};this.getH=function(){return p};this.setCounter=function(a){f=
a};this.getCounter=function(){return f};this.setSpeedX=function(a){v=a};this.getSpeedX=function(){return v};this.setSpeedY=function(a){d=a};this.getSpeedY=function(){return d};this.setSpeed=function(a){d=v=a};this.setCollidable=function(a){t=a};this.isCollidable=function(){return t};this.setObstacle=function(a){u=a};this.isObstacle=function(){return u};this.setDraggable=function(a){c=a};this.isDraggable=function(){return c};this.setName=function(a){y=a};this.getName=function(){return y};this.setIsColliding=
function(a){s=a};this.isColliding=function(){return s};this.setCollidingCoords=function(b){a=b};this.getCollidingCoords=function(){return a};this.getX2=function(){return j+n};this.getY2=function(){return k+p};this.setVisible=function(a){r=a};this.isVisible=function(){return r};this.fn=function(){this.draw()};this.run=function(){this.fn()};this.clone=function(){var a=new RB.Obj(b,h);a.setX(j);a.setY(k);a.setW(n);a.setH(p);a.setCollidable(t);a.setObstacle(u);a.setCounter(f);a.fn=this.fn;a.setSpeedX(v);
a.setSpeedY(d);a.setSprites(x,this.getSpriteInterval());a.setDraggable(c);a.setVisible(r);return a};this.draw=function(a,b){a&&b?h.drawImage(q,j,k,a,b):h.drawImage(q,j,k)};this.up=function(a){k-=a||d;e="up"};this.down=function(a){k+=a||d;e="down"};this.left=function(a){j-=a||v;e="left"};this.right=function(a){j+=a||v;e="right"};this.setSprites=function(a,b){x=a;z=b};this.animateSprite=function(){A==z?(q=x[++B]?x[B]:x[B=0],A=0):A++};this.checkCollision=function(a,b){var c=a.getX(),f=a.getY(),g=a.getX2(),
h=a.getY2();b&&(c-=v,f-=d,g-=v,h-=d);var l={top:!1,bottom:!1,left:!1,right:!1};if(e=="up"){var m=k<h&&k+p>h,i=j<g&&j+n>c;m&&i&&(l.top=!0)}if(e=="down")m=k+p>f&&k+p<h,i=j<g&&j+n>c,m&&i&&(l.bottom=!0);if(e=="left")m=k<h&&k+p>f,i=j<g&&j+n>g,m&&i&&(l.left=!0);if(e=="right")m=k<h&&k+p>f,i=j+n>c&&j+n<g,m&&i&&(l.right=!0);return l};this.checkRange=function(a,b){var c=b>=k&&b<=k+p;return a>=j&&a<=j+n&&c};this.onCollide=function(){};this.onNonCollide=function(){};this.boom=function(){this.onCollide()}};
RB.createTextBuffer=function(){var b=document,g=b.createElement("div");g.id="txtBuffer";g.style.position="absolute";g.style.width="auto";g.style.height="auto";g.style.padding="0px";g.style.visibility="hidden";b.body.appendChild(g)};RB.getTextBuffer=function(){RB.el("txtBuffer")||RB.createTextBuffer();return RB.el("txtBuffer")};RB.createCanvasLocation=null;
RB.createCanvas=function(b,g,i){var l=document,m=l.createElement("canvas");m.width=b;m.height=g;m.id=i;m.style.display="none";RB.createCanvasLocation?RB.createCanvasLocation.appendChild(m):l.body.appendChild(m);return m};RB.destroyCanvas=function(b){var g=document,b=g.getElementById(b);g.body.removeChild(b)};RB.el=function(b){return document.getElementById(b)};
RB.linearGradient=function(b,g){var i=g.createLinearGradient(0,5,0,b.h);csLen=b.colors.length;for(var l=0;l<csLen;l++){var m=b.colors[l];i.addColorStop(m.stopPoint,m.name)}return i};RB.getFS=function(b,g,i){if(typeof b=="object")return b.h=i,RB.linearGradient(b,g);return b};RB.rtImage=function(b,g,i){var l=new Image;l.onload=function(){var b=RB.createCanvas(l.width,l.height,g);b.getContext("2d").drawImage(this,0,0);i&&i(b)};l.src=b};
RB.canvasSupport=function(b){if(b)try{return b.getContext("2d"),!0}catch(g){return!1}else return!1};RB.xPos=function(b){return b.pageX-b.target.offsetLeft};RB.yPos=function(b){return b.pageY-b.target.offsetTop};
